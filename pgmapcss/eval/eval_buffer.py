def eval_buffer(param):
    if len(param) < 2:
        return ''

    radius = eval_metric([param[1], 'u'])

    if radius == '':
        return ''

    plan = plpy.prepare('select ST_Buffer($1, $2) as r', ['geometry', 'float'])
    res = plpy.execute(plan, [ param[0], float(radius) ])

    return res[0]['r']

# TESTS
# IN ['010200002031BF0D0002000000EC51B8DE163A3A410AD7A36078B45641295C8F826E393A4152B81E8573B45641', '10u']
# OUT '010300002031BF0D000100000023000000C5170EA86F393A41FC05570971B45641950847B26D393A41F8E33D0771B45641600B81C46B393A41C829A81D71B456413DD6B5F169393A41A952B94B71B45641C7B2D54B68393A41402AAC8F71B456417D0317E366393A413337E4E671B456418BC456C565393A41916B074E72B45641142990FD64393A414E1E1FC172B45641D192709364393A416B09BF3B73B45641C10A0C8B64393A4137CD30B973B456410122B5E464393A41844CA23474B4564185C5F99C65393A41CD1955A974B45641E123C5AC66393A41AA22CD1275B45641AE57A50968393A417DCEFC6C75B45641252932A669393A413ADE6CB475B4564117F490726B393A4117855EE675B456418DA0105D6D393A41A86AE60076B45641509639B9153A3A4160896BDC7AB4564180A500AF173A3A4164AB84DE7AB45641B5A2C69C193A3A4194651AC87AB45641D8D7916F1B3A3A41B33C099A7AB456414EFB71151D3A3A411C6516567AB4564198AA307E1E3A3A412958DEFE79B456418AE9F09B1F3A3A41CB23BB9779B456410185B763203A3A410E71A32479B45641441BD7CD203A3A41F18503AA78B4564154A33BD6203A3A4125C2912C78B45641148C927C203A3A41D84220B177B4564190E84DC41F3A3A418F756D3C77B45641348A82B41E3A3A41B26CF5D276B456416756A2571D3A3A41DFC0C57876B45641F08415BB1B3A3A4122B1553176B45641FEB9B6EE193A3A41450A64FF75B45641880D3704183A3A41B424DCE475B45641C5170EA86F393A41FC05570971B45641'
# IN ['010200002031BF0D0002000000EC51B8DE163A3A410AD7A36078B45641295C8F826E393A4152B81E8573B45641', '10']
# OUT '010300002031BF0D00010000002300000073E9194071393A4198376A956DB456419BC8B3906C393A41F74E66906DB45641448C6FF467393A417080FAC56DB456419197A89863393A41F9B017346EB4564168DC3FA85F393A411D9582D66EB45641EF04F6495C393A416152FDA66FB45641B734EE9E59393A41D2E6849D70B45641200868C157393A41BCFA9FB071B456414159BDC356393A41FF14BCD572B45641BCB6ADAF56393A41369D950174B456419F7CFE8557393A414BACA62875B45641C33E733E59393A417869983F76B4564156CF1EC85B393A414298B23B77B4564165C4090A5F393A41200E451378B456412A1628E462393A412E0207BE78B45641CF65943067393A41548D683579B45641DFCE04C56B393A410C39D37479B45641A2C42D21143A3A41C45758507EB456417AE593D0183A3A4165405C557EB45641D121D86C1D3A3A41EC0EC81F7EB4564184169FC8213A3A4163DEAAB17DB45641ADD107B9253A3A413FFA3F0F7DB4564126A95117293A3A41FB3CC53E7CB456415E7959C22B3A3A418AA83D487BB45641F5A5DF9F2D3A3A41A09422357AB45641D4548A9D2E3A3A415D7A061079B4564159F799B12E3A3A4126F22CE477B45641763149DB2D3A3A4111E31BBD76B45641526FD4222C3A3A41E4252AA675B45641BFDE2899293A3A411AF70FAA74B45641B0E93D57263A3A413C817DD273B45641EB971F7D223A3A412E8DBB2773B456414648B3301E3A3A4108025AB072B4564136DF429C193A3A415056EF7072B4564173E9194071393A4198376A956DB45641'
# IN ['010200002031BF0D0002000000EC51B8DE163A3A410AD7A36078B45641295C8F826E393A4152B81E8573B45641', '10px']
# OUT '010300002031BF0D00010000002300000073E9194071393A4198376A956DB456419BC8B3906C393A41F74E66906DB45641448C6FF467393A417080FAC56DB456419197A89863393A41F9B017346EB4564168DC3FA85F393A411D9582D66EB45641EF04F6495C393A416152FDA66FB45641B734EE9E59393A41D2E6849D70B45641200868C157393A41BCFA9FB071B456414159BDC356393A41FF14BCD572B45641BCB6ADAF56393A41369D950174B456419F7CFE8557393A414BACA62875B45641C33E733E59393A417869983F76B4564156CF1EC85B393A414298B23B77B4564165C4090A5F393A41200E451378B456412A1628E462393A412E0207BE78B45641CF65943067393A41548D683579B45641DFCE04C56B393A410C39D37479B45641A2C42D21143A3A41C45758507EB456417AE593D0183A3A4165405C557EB45641D121D86C1D3A3A41EC0EC81F7EB4564184169FC8213A3A4163DEAAB17DB45641ADD107B9253A3A413FFA3F0F7DB4564126A95117293A3A41FB3CC53E7CB456415E7959C22B3A3A418AA83D487BB45641F5A5DF9F2D3A3A41A09422357AB45641D4548A9D2E3A3A415D7A061079B4564159F799B12E3A3A4126F22CE477B45641763149DB2D3A3A4111E31BBD76B45641526FD4222C3A3A41E4252AA675B45641BFDE2899293A3A411AF70FAA74B45641B0E93D57263A3A413C817DD273B45641EB971F7D223A3A412E8DBB2773B456414648B3301E3A3A4108025AB072B4564136DF429C193A3A415056EF7072B4564173E9194071393A4198376A956DB45641'
