class config_eval_buffer(config_base):
    mutable = 2

def eval_buffer(param, current):
    if len(param) < 2:
        return ''

    radius = eval_metric([param[1], 'u'], current)

    if radius == '':
        return ''

    plan = plpy.prepare('select ST_Buffer($1, $2) as r', ['geometry', 'float'])
    res = plpy.execute(plan, [ param[0], float(radius) ])

    return res[0]['r']

# TESTS
# IN ['010200002031BF0D0002000000EC51B8DE163A3A410AD7A36078B45641295C8F826E393A4152B81E8573B45641', '10u']
# OUT '010300002031BF0D000100000023000000C5170EA86F393A41FC05570971B45641950847B26D393A41F8E33D0771B45641600B81C46B393A41C829A81D71B456413DD6B5F169393A41A952B94B71B45641C7B2D54B68393A41402AAC8F71B456417D0317E366393A413337E4E671B456418BC456C565393A41916B074E72B45641142990FD64393A414E1E1FC172B45641D192709364393A416B09BF3B73B45641C10A0C8B64393A4137CD30B973B456410122B5E464393A41844CA23474B4564185C5F99C65393A41CD1955A974B45641E123C5AC66393A41AA22CD1275B45641AE57A50968393A417DCEFC6C75B45641252932A669393A413ADE6CB475B4564117F490726B393A4117855EE675B456418DA0105D6D393A41A86AE60076B45641509639B9153A3A4160896BDC7AB4564180A500AF173A3A4164AB84DE7AB45641B5A2C69C193A3A4194651AC87AB45641D8D7916F1B3A3A41B33C099A7AB456414EFB71151D3A3A411C6516567AB4564198AA307E1E3A3A412958DEFE79B456418AE9F09B1F3A3A41CB23BB9779B456410185B763203A3A410E71A32479B45641441BD7CD203A3A41F18503AA78B4564154A33BD6203A3A4125C2912C78B45641148C927C203A3A41D84220B177B4564190E84DC41F3A3A418F756D3C77B45641348A82B41E3A3A41B26CF5D276B456416756A2571D3A3A41DFC0C57876B45641F08415BB1B3A3A4122B1553176B45641FEB9B6EE193A3A41450A64FF75B45641880D3704183A3A41B424DCE475B45641C5170EA86F393A41FC05570971B45641'
# IN ['010200002031BF0D0002000000EC51B8DE163A3A410AD7A36078B45641295C8F826E393A4152B81E8573B45641', '10']
# OUT '010300002031BF0D000100000023000000D194194071393A41EDEE6A956DB45641AA04B4906C393A41E70667906DB45641B55670F467393A41E931FBC56DB456419EE8A99863393A41295518346EB456411BA741A85F393A41B62583D66EB45641A837F8495C393A41D3C9FDA66FB45641D6B9F09E59393A418740859D70B45641DAC66AC157393A414033A0B071B456419536C0C356393A41282ABCD572B456417C96B0AF56393A41328E950174B456418442018657393A41AF79A62875B4564186CF753E59393A413515983F76B45641B91121C85B393A419625B23B77B456412DA20B0A5F393A417281441378B45641FD7C29E462393A41E76006BE78B45641E147953067393A41A6DD673579B45641812305C56B393A41B781D27479B4564144192E21143A3A416FA057507EB456416BA993D0183A3A4175885B557EB456416057D76C1D3A3A41735DC71F7EB4564177C59DC8213A3A41333AAAB17DB45641FA0606B9253A3A41A6693F0F7DB456416D764F17293A3A4189C5C43E7CB456413FF456C22B3A3A41D54E3D487BB456413BE7DC9F2D3A3A411C5C22357AB456418077879D2E3A3A413465061079B45641991797B12E3A3A412A012DE477B45641916B46DB2D3A3A41AD151CBD76B456418FDED1222C3A3A41277A2AA675B456415C9C2699293A3A41C66910AA74B45641E80B3C57263A3A41EA0D7ED273B4564118311E7D223A3A41752EBC2773B456413466B2301E3A3A41B6B15AB072B45641948A429C193A3A41A50DF07072B45641D194194071393A41EDEE6A956DB45641'
# IN ['010200002031BF0D0002000000EC51B8DE163A3A410AD7A36078B45641295C8F826E393A4152B81E8573B45641', '10px']
# OUT '010300002031BF0D000100000023000000D194194071393A41EDEE6A956DB45641AA04B4906C393A41E70667906DB45641B55670F467393A41E931FBC56DB456419EE8A99863393A41295518346EB456411BA741A85F393A41B62583D66EB45641A837F8495C393A41D3C9FDA66FB45641D6B9F09E59393A418740859D70B45641DAC66AC157393A414033A0B071B456419536C0C356393A41282ABCD572B456417C96B0AF56393A41328E950174B456418442018657393A41AF79A62875B4564186CF753E59393A413515983F76B45641B91121C85B393A419625B23B77B456412DA20B0A5F393A417281441378B45641FD7C29E462393A41E76006BE78B45641E147953067393A41A6DD673579B45641812305C56B393A41B781D27479B4564144192E21143A3A416FA057507EB456416BA993D0183A3A4175885B557EB456416057D76C1D3A3A41735DC71F7EB4564177C59DC8213A3A41333AAAB17DB45641FA0606B9253A3A41A6693F0F7DB456416D764F17293A3A4189C5C43E7CB456413FF456C22B3A3A41D54E3D487BB456413BE7DC9F2D3A3A411C5C22357AB456418077879D2E3A3A413465061079B45641991797B12E3A3A412A012DE477B45641916B46DB2D3A3A41AD151CBD76B456418FDED1222C3A3A41277A2AA675B456415C9C2699293A3A41C66910AA74B45641E80B3C57263A3A41EA0D7ED273B4564118311E7D223A3A41752EBC2773B456413466B2301E3A3A41B6B15AB072B45641948A429C193A3A41A50DF07072B45641D194194071393A41EDEE6A956DB45641'
